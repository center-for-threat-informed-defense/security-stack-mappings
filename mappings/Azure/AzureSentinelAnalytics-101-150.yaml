version: 1
ATT&CK version: 8.1
creation date: 04/15/2021
name: Azure Sentinel Analytics
author: Matt Bajzek
contact: ctid@mitre-engenuity.org
organization: Center for Threat Informed Defense (CTID)
platform: Azure
description: Out of the box Azure Sentinel Analytics (from the rule template list)
techniques:
  - id: T1562
    name: Impair Defenses
    technique-scores:
      - category: Detect
        value: Minimal
        comments: TODO
    sub-techniques-scores:
      - sub-techniques:
          - id: T1562.001
            name: Disable or Modify Tools
        scores:
          - category: Detect
            value: Partial
            comments: >-
              Can detect "Starting or Stopping HealthService to Avoid Detection" to disable
              telemetry collection/detection at a default frequency of once per day.
      - sub-techniques:
          - id: T1562.008
            name: Disable Cloud Logs
        scores:
          - category: Detect
            value: Partial
            comments: Can detect "Exchange AuditLog disabled" events at a default frequency of once per day.
  - id: T1568
    name: Dynamic Resolution
    technique-scores:
      - category: Detect
        value: Minimal
        comments: TODO
    sub-techniques-scores:
      - sub-techniques:
          - id: T1568.002
            name: Domain Generation Algorithms
        scores:
          - category: Detect
            value: Partial
            comments: >-
              Can detect "Possible contact with a domain generated by a DGA" at a default frequency
              of once every 6 hours and identify "Potential DGA detected" within DNS at a default
              frequency of once per day.
  - id: T1190
    name: Exploit Public-Facing Application
    technique-scores:
      - category: Detect
        value: Minimal
        comments: >-
          Can detect when "A potentially malicious web request was executed against a web server"
          based on a high ratio of blocked requests and unobstructed requests to a Web Application
          Firewall (WAF) for a given client IP and hostname, with a default frequency of once per
          day.
  - id: T1078
    name: Valid Accounts
    technique-scores:
      - category: Detect
        value: Minimal
        comments: TODO
    sub-techniques-scores:
      - sub-techniques:
          - id: T1078.004
            name: Cloud Accounts
          - id: T1078.002
            name: Domain Accounts
        scores:
          - category: Detect
            value: Minimal
            comments: >-
              Can detect "Anomalous sign-in location by user account and authenticating application"
              as well as "Anomalous login followed by Teams action" at a default rate of once per
              day, based on the past 14 days of Azure Active Directory sign-in events. Can also
              detect a "GitHub Signin Burst from Multiple Locations" at a default rate of once per
              hour. Note that IP address location-based detection may result in a high false
              positive rate, and that misuse from a typical location is not covered. Can also detect
              "Sign-ins from IPs that attempt sign-ins to disabled accounts" which may indicate that
              use of the valid account(s) is malicious and a follow-up to a brute-force style
              technique.
  - id: T1137
    name: Office Application Startup
    technique-scores:
      - category: Detect
        value: Minimal
        comments: TODO
    sub-techniques-scores:
      - sub-techniques:
          - id: T1137.005
            name: Outlook Rules
        scores:
          - category: Detect
            value: Partial
            comments: >-
              Can detect "Office policy tampering", a "Malicious Inbox Rule" intended to delete
              emails that contain certain keywords (generally meant to warn compromised users about
              adversary behaviors), and "Mail redirect via ExO transport rule" (potentially to an
              adversary mailbox configured to collect mail) at a default frequency of once per day.
  - id: T1110
    name: Brute Force
    technique-scores:
      - category: Detect
        value: Partial
        comments: This control includes detection coverage for all sub-techniques on a periodic basis.
    sub-techniques-scores:
      - sub-techniques:
          - id: T1110.001
            name: Password Guessing
          - id: T1110.003
            name: Password Spraying
          - id: T1110.004
            name: Credential Stuffing
          - id: T1110.002
            name: Password Cracking
        scores:
          - category: Detect
            value: Partial
            comments: >-
              Can detect "Brute Force Attack against GitHub Account", "Distributed Password cracking
              attempts in AzureAD", and "Potential Password Spray Attack" based on periodic
              assessment of Azure Active Directory sign-in events and Okta console logins. Can also
              detect "Attempts to sign in to disabled accounts" and "Sign-ins from IPs that attempt
              sign-ins to disabled accounts" which may indicate attempts to brute force that include
              disabled accounts.
  - id: T1140
    name: Deobfuscate/Decode Files or Information
    technique-scores:
      - category: Detect
        value: Partial
        comments: >-
          Can detect "Process executed from binary hidden in Base64 encoded file" based on security
          event searches for decoding by Python, bash/sh, and Ruby at a default frequency of once
          per day.
  - id: T1136
    name: Create Account
    technique-scores:
      - category: Detect
        value: Minimal
        comments: TODO
    sub-techniques-scores:
      - sub-techniques:
          - id: T1136.001
            name: Local Account
          - id: T1136.002
            name: Domain Account
          - id: T1136.003
            name: Cloud Account
        scores:
          - category: Detect
            value: Minimal
            comments: >-
              Can detect "User account created and deleted within 10 mins", which suggests the
              account may serve a malicious purpose, at a default frequency of once per day. Note
              that this only covers the case in which an adversary deletes the account within 10
              minutes of its creation.
  - id: T1558
    name: Steal or Forge Kerberos Tickets
    technique-scores:
      - category: Detect
        value: Minimal
        comments: TODO
    sub-techniques-scores:
      - sub-techniques:
          - id: T1558.003
            name: Kerberoasting
        scores:
          - category: Detect
            value: Partial
            comments: >-
              Can detect "Potential Kerberoasting" at a default frequency of once per hour based on
              the previous day of security events.
  - id: T1047
    name: Windows Management Instrumentation
    technique-scores:
      - category: Detect
        value: Partial
        comments: >-
          Can detect when adversaries "Gain Code Execution on ADFS Server via Remote WMI Execution",
          at a default frequency of once per day. Note that this only looks for this behavior on
          ADFS servers.
  - id: T1046
    name: Network Service Scanning
    technique-scores:
      - category: Detect
        value: Partial
        comments: >-
          Can detect a "High count of connections by client IP on many ports" if a given client IP
          has 30 or more ports used within a 10 minute window, checked at a default frequency of
          once per hour. Note that false positives are probable based on changes in usage patterns
          and/or misconfiguration, and this detection only works if scanning is not spread out over
          a longer timespan.
  - id: T1595
    name: Active Scanning
    technique-scores:
      - category: Detect
        value: Minimal
        comments: TODO
    sub-techniques-scores:
      - sub-techniques:
          - id: T1595.002
            name: Vulnerability Scanning
        scores:
          - category: Detect
            value: Partial
            comments: >-
              Can detect a "High count of connections by client IP on many ports" if a given client
              IP has 30 or more ports used within a 10 minute window, checked at a default frequency
              of once per hour. Note that false positives are probable based on changes in usage
              patterns and/or misconfiguration, and this detection only works if scanning is not
              spread out over a longer timespan.
  - id: T1018
    name: Remote System Discovery
    technique-scores:
      - category: Detect
        value: Partial
        comments: >-
          Can detect when "Several deny actions registered" due to Azure Firewall incidents,
          potentially indicating that an adversary is scanning resources on the network, at a
          default frequency of once per hour. Note that detection only occurs if the firewall
          prevents the scanning. Can also detect "Rare client observed with high reverse DNS lookup
          count" if a particular IP is observed performing an unusually high number of reverse DNS
          lookups and has not been observed doing so previously.
  - id: T1021
    name: Remote Services
    technique-scores:
      - category: Detect
        value: Minimal
        comments: TODO
    sub-techniques-scores:
      - sub-techniques:
          - id: T1021.001
            name: Remote Desktop Protocol
        scores:
          - category: Detect
            value: Minimal
            comments: >-
              Can detect "RDP Nesting" when an RDP connection is made to a system and then an RDP
              connection is made from that system to another system using the same account within 60
              minutes. Control operates at a default frequency of once per day.
  - id: T1552
    name: Unsecured Credentials
    technique-scores:
      - category: Protect
        value: Minimal
        comments: >-
          This control provides a highly specific detection for a misconfiguration that can lead to
          one of this technique's sub-techniques.
    sub-techniques-scores:
      - sub-techniques:
          - id: T1552.001
            name: Credentials In Files
        scores:
          - category: Protect
            value: Minimal
            comments: >-
              Can protect against future credential access by detecting "Azure DevOps - Variable
              Secret Not Secured" and suggesting that credentials be moved to a secret or stored in
              KeyVault before they can be accessed by an adversary.
  - id: T1590
    name: Gather Victim Network Information
    technique-scores:
      - category: Detect
        value: Minimal
        comments: >-
          This control detects a highly specific behavior that applies to one sub-technique of this
          technique.
    sub-techniques-scores:
      - sub-techniques:
          - id: T1590.002
            name: DNS
        scores:
          - category: Detect
            value: Minimal
            comments: >-
              Can detect "Rare client observed with high reverse DNS lookup count" if a particular
              IP is observed performing an unusually high number of reverse DNS lookups and has not
              been observed doing so previously.
comments: >-
  Note: only mapped out of the box analytics. Did not score analytics that were specific ioc-based
  (e.g.  ip addresses or hashes ).  Did not score analytics that required a 3rd party integration
    (e.g. Alsid or TrendMicro). Refer to specific analytics by name in quotes.
